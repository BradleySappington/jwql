# YAML file defining bokeh figures for the bad pixel monitor
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Dead Pixels v. Time Figure
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- !ColumnDataSource: &dead_history_source
  ref: "dead_history_source"
  data:
    time: !self.bad_history['DEAD'][0]
    dead_pixels: !self.bad_history['DEAD'][1]
    time_labels: !self.bad_history['DEAD'][2]

- !Range1d: &dead_history_xrange
  ref: "dead_history_xrange"
  start: 0
  end: 1
  bounds: 'auto'  #!!python/tuple [0, 1]

- !Range1d: &dead_history_yrange
  ref: "dead_history_yrange"
  start: 0
  end: 1
  bounds: 'auto'  # !!python/tuple [-1, 1]

- !Figure: &dead_history_figure
  ref: "dead_history_figure"
  x_axis_label: "Date"
  x_axis_type: "datetime"
  y_axis_label: "Number of DEAD pixels"
  x_range: *dead_history_xrange
  y_range: *dead_history_yrange
  tools: 'hover'
  tooltips: "[('Date:', '@time_labels'), ('Dead pix': '@dead_pixels')]"
  elements:
    - {'kind': 'circle', 'x': 'time', 'y': 'dead_pixels', line_width: 5, 'source': *dead_history_source}

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Hot Pixels v. Time Figure
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- !ColumnDataSource: &hot_history_source
  ref: "hot_history_source"
  data:
    time: !self.bad_history['HOT'][0]
    hot_pixels: !self.bad_history['HOT'][1]
    time_labels: !self.bad_history['HOT'][2]

- !Range1d: &hot_history_xrange
  ref: "hot_history_xrange"
  start: 0
  end: 1
  bounds: 'auto'  #!!python/tuple [0, 1]

- !Range1d: &hot_history_yrange
  ref: "hot_history_yrange"
  start: 0
  end: 1
  bounds: 'auto'  #!!python/tuple [-1, 1]

- !Figure: &hot_history_figure
  ref: "hot_history_figure"
  x_axis_label: "Date"
  x_axis_type: "datetime"
  y_axis_label: "Number of HOT pixels"
  x_range: *hot_history_xrange
  y_range: *hot_history_yrange
  tools: 'hover'
  tooltips: "[('Date:', '@time_labels'), ('Hot pix': '@hot_pixels')]"
  elements:
    - {'kind': 'circle', 'x': 'time', 'y': 'hot_pixels', line_width: 5, 'source': *hot_history_source}

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Low QE Pixels v. Time Figure
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- !ColumnDataSource: &low_qe_history_source
  ref: "low_qe_history_source"
  data:
    time: !self.bad_history['LOW_QE'][0]
    low_qe_pixels: !self.bad_history['LOW_QE'][1]
    time_labels: !self.bad_history['LOW_QE'][2]

- !Range1d: &low_qe_history_xrange
  ref: "low_qe_history_xrange"
  start: 0
  end: 1
  bounds: 'auto'  #!!python/tuple [0, 1]

- !Range1d: &low_qe_history_yrange
  ref: "low_qe_history_yrange"
  start: 0
  end: 1
  bounds: 'auto'  #!!python/tuple [-1, 1]

- !Figure: &low_qe_history_figure
  ref: "low_qe_history_figure"
  x_axis_label: "Date"
  x_axis_type: "datetime"
  y_axis_label: "Number of LOW QE pixels"
  x_range: *low_qe_history_xrange
  y_range: *low_qe_history_yrange
  tools: 'hover'
  tooltips: "[('Date:', '@time_labels'), ('Low QE pix': '@low_qe_pixels')]"
  elements:
    - {'kind': 'circle', 'x': 'time', 'y': 'low_qe_pixels', line_width: 5, 'source': *low_qe_history_source}

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Open Pixels v. Time Figure
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- !ColumnDataSource: &open_history_source
  ref: "open_history_source"
  data:
    time: !self.bad_history['OPEN'][0]
    open_pixels: !self.bad_history['OPEN'][1]
    time_labels: !self.bad_history['OPEN'][2]

- !Range1d: &open_history_xrange
  ref: "open_history_xrange"
  start: 0
  end: 1
  bounds: 'auto'  #!!python/tuple [0, 1]

- !Range1d: &open_history_yrange
  ref: "open_history_yrange"
  start: 0
  end: 1
  bounds: 'auto'  #!!python/tuple [-1, 1]

- !Figure: &open_history_figure
  ref: "open_history_figure"
  x_axis_label: "Date"
  x_axis_type: "datetime"
  y_axis_label: "Number of OPEN pixels"
  x_range: *open_history_xrange
  y_range: *open_history_yrange
  tools: 'hover'
  tooltips: "[('Date:', '@time_labels'), ('Open pix': '@open_pixels')]"
  elements:
    - {'kind': 'circle', 'x': 'time', 'y': 'open_pixels', line_width: 5, 'source': *open_history_source}

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Open Adj Pixels v. Time Figure
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- !ColumnDataSource: &adj_open_history_source
  ref: "adj_open_history_source"
  data:
    time: !self.bad_history['ADJ_OPEN'][0]
    adj_open_pixels: !self.bad_history['ADJ_OPEN'][1]
    time_labels: !self.bad_history['ADJ_OPEN'][2]

- !Range1d: &adj_open_history_xrange
  ref: "adj_open_history_xrange"
  start: 0
  end: 1
  bounds: 'auto'  #!!python/tuple [0, 1]

- !Range1d: &adj_open_history_yrange
  ref: "adj_open_history_yrange"
  start: 0
  end: 1
  bounds: 'auto'  #!!python/tuple [-1, 1]

- !Figure: &adj_open_history_figure
  ref: "adj_open_history_figure"
  x_axis_label: "Date"
  x_axis_type: "datetime"
  y_axis_label: "Number of OPEN ADJACENT pixels"
  x_range: *adj_open_history_xrange
  y_range: *adj_open_history_yrange
  tools: 'hover'
  tooltips: "[('Date:', '@time_labels'), ('Adj open pix': '@adj_open_pixels')]"
  elements:
    - {'kind': 'circle', 'x': 'time', 'y': 'adj_open_pixels', line_width: 5, 'source': *adj_open_history_source}

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# RC Pixels v. Time Figure
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- !ColumnDataSource: &rc_history_source
  ref: "rc_history_source"
  data:
    time: !self.bad_history['RC'][0]
    rc_pixels: !self.bad_history['RC'][1]
    time_labels: !self.bad_history['RC'][2]

- !Range1d: &rc_history_xrange
  ref: "rc_history_xrange"
  start: 0
  end: 1
  bounds: 'auto'  #!!python/tuple [0, 1]

- !Range1d: &rc_history_yrange
  ref: "rc_history_yrange"
  start: 0
  end: 1
  bounds: 'auto'  #!!python/tuple [-1, 1]

- !Figure: &rc_history_figure
  ref: "rc_history_figure"
  x_axis_label: "Date"
  x_axis_type: "datetime"
  y_axis_label: "Number of RC pixels"
  x_range: *rc_history_xrange
  y_range: *rc_history_yrange
  tools: 'hover'
  tooltips: "[('Date:', '@time_labels'), ('RC pix': '@rc_pixels')]"
  elements:
    - {'kind': 'circle', 'x': 'time', 'y': 'rc_pixels', line_width: 5, 'source': *rc_history_source}


# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Other Bad Pixels v. Time Figure
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- !ColumnDataSource: &other_bad_pixel_history_source
  ref: "other_bad_pixel_history_source"
  data:
    time: !self.bad_history['OTHER_BAD_PIXEL'][0]
    other_bad_pixel_pixels: !self.bad_history['OTHER_BAD_PIXEL'][1]
    time_labels: !self.bad_history['OTHER_BAD_PIXEL'][2]

- !Range1d: &other_bad_pixel_history_xrange
  ref: "other_bad_pixel_history_xrange"
  start: 0
  end: 1
  bounds: 'auto'  #!!python/tuple [0, 1]

- !Range1d: &other_bad_pixel_history_yrange
  ref: "other_bad_pixel_history_yrange"
  start: 0
  end: 1
  bounds: 'auto'  #!!python/tuple [-1, 1]

- !Figure: &other_bad_pixel_history_figure
  ref: "other_bad_pixel_history_figure"
  x_axis_label: "Date"
  x_axis_type: "datetime"
  y_axis_label: "Number of OTHER BAD pixels"
  x_range: *other_bad_pixel_history_xrange
  y_range: *other_bad_pixel_history_yrange
  tools: 'hover'
  tooltips: "[('Date:', '@time_labels'), ('Other bad pix': '@other_bad_pixel_pixels')]"
  elements:
    - {'kind': 'circle', 'x': 'time', 'y': 'other_bad_pixel_pixels', line_width: 5, 'source': *other_bad_pixel_history_source}


# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Telegraph Pixels v. Time Figure
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
- !ColumnDataSource: &telegraph_history_source
  ref: "telegraph_history_source"
  data:
    time: !self.bad_history['TELEGRAPH'][0]
    telegraph_pixels: !self.bad_history['TELEGRAPH'][1]
    time_labels: !self.bad_history['TELEGRAPH'][2]

- !Range1d: &telegraph_history_xrange
  ref: "telegraph_history_xrange"
  start: 0
  end: 1
  bounds: 'auto'  #!!python/tuple [0, 1]

- !Range1d: &telegraph_history_yrange
  ref: "telegraph_history_yrange"
  start: 0
  end: 1
  bounds: 'auto'  #!!python/tuple [-1, 1]

- !Figure: &telegraph_history_figure
  ref: "telegraph_history_figure"
  x_axis_label: "Date"
  x_axis_type: "datetime"
  y_axis_label: "Number of TELEGRAPH pixels"
  x_range: *telegraph_history_xrange
  y_range: *telegraph_history_yrange
  tools: 'hover'
  tooltips: "[('Date:', '@time_labels'), ('Telegraph pix': '@telegraph_pixels')]"
  elements:
    - {'kind': 'circle', 'x': 'time', 'y': 'telegraph_pixels', line_width: 5, 'source': *telegraph_history_source}



# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Mean Dark Image Figure
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#- !ColumnDataSource: &bkgd_image
#    ref: "bkgd_image"
#    data:
#        dh: [1]
#        dw: [1]
#        image: [[[1,0], [0, 1]]]
#        dead_pixels_x: !self.bad_latestxxxxx
#        dead_pixels_y: !self.bad_latestxxxxx
#- !Range1d: &stamp_xr
#    ref: "stamp_xr"
#    #start: 0
#    #end: 1
#    #bounds: !!python/tuple [0, 1]
#- !Range1d: &stamp_yr
#    ref: "stamp_yr"
#    #start: 0
#    #end: 1
#    #bounds: !!python/tuple [0, 1]
#- !LogColorMapper: &log_mapper
#    ref: "log_mapper"
#    palette: "Greys256"
#    low: 0.
#    high: 1.
#- !Figure: &badpix_image_figure
#    ref: "badpix_image_figure"
#    x_axis_label: "Col = SIAF det Y"
#    y_axis_label: "Row = SIAF det X"
#    x_range: *stamp_xr
#    y_range: *stamp_yr
#    tools: ""
#    height: 2048  # Not working
#    width: 2048  # Not working
#    elements:
#        - {"kind": "image", "image": "image", "x": 0, "y": 0, "dh": 'dh', "dw": 'dw', "source": *bkgd_image, "color_mapper": *log_mapper}
#        - {'kind': 'circle', 'x': 'dead_pixels_x', 'y': 'dead_pixels_y', line_width: 5, 'source': *other_bad_pixel__history_source}
#        - {'kind': 'circle', 'x': 'hot_pixels_x', 'y': 'hot_pixels_y', line_width: 5, 'source': *other_bad_pixel__history_source}
#        - {'kind': 'circle', 'x': 'open_pixels_x', 'y': 'open_pixels_y', line_width: 5, 'source': *other_bad_pixel__history_source}
#        - {'kind': 'circle', 'x': 'adjopen_pixels_x', 'y': 'adjopen_pixels_y', line_width: 5, 'source': *other_bad_pixel__history_source}


- !Document:
  - !row:
    - *dead_history_figure
    - *hot_history_figure
  - !row:
    - *low_qe_history_figure
    - *rc_history_figure
  - !row:
    - *open_history_figure
    - *adj_open_history_figure
  - !row:
    - *telegraph_history_figure
    - *other_bad_pixel_history_figure